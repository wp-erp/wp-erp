!function(a){"use strict";var b={initialize:function(){var b=this;a(".erp-hr-leave-policy").on("click","a#erp-leave-policy-new",b,this.policy.create),a(".erp-hr-leave-policy").on("click","a.link, span.edit a",b,this.policy.edit),a(".erp-hr-leave-policy").on("click","a.submitdelete",b,this.policy.remove),a("body").on("change","#erp-hr-leave-req-from-date, #erp-hr-leave-req-to-date",b,this.leave.requestDates),a("body").on("change","#erp-hr-leave-req-employee-id",b,this.leave.setPolicy),a("body").on("change","#erp-hr-leave-req-leave-policy",b,this.leave.setAvailableDays),a(".hrm-dashboard").on("click",".erp-hr-new-leave-request-wrap a#erp-hr-new-leave-req",this.leave.takeLeave),a(".erp-employee-single").on("submit","form#erp-hr-empl-leave-history",this.leave.showHistory),a(".entitlement-list-table").on("click","a.submitdelete",b,this.entitlement.remove),a(".erp-hr-holiday-wrap").on("click","a#erp-hr-new-holiday",b,this.holiday.create),a(".erp-hr-holiday-wrap").on("click",".erp-hr-holiday-edit",b,this.holiday.edit),a(".erp-hr-holiday-wrap").on("click",".erp-hr-holiday-delete",b,this.holiday.remove),a("body").on("change",".erp-hr-holiday-date-range",b,this.holiday.checkRange),a(".erp-hr-holiday-wrap").on("click","#erp-hr-import-ical",b,this.importICalInit),a(".erp-hr-holiday-wrap").on("change","#erp-ical-input",b,this.uploadICal),a(".erp-hr-leave-requests").on("click",".erp-hr-leave-reject-btn",b,this.leave.reject),this.initDateField()},initToggleCheckbox:function(){var b=!1;a("tbody").children().children(".check-column").find(":checkbox").click(function(c){if("undefined"==c.shiftKey)return!0;if(c.shiftKey){if(!b)return!0;checks=a(b).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(b),last=checks.index(this),checked=a(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!a(this).closest("tr").is(":visible")&&checked}))}b=this;var d=a(this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return a(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===d.length}),!0}),a("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(b){var c=a(this),d=c.closest("table"),e=c.prop("checked"),f=b.shiftKey||c.data("wp-toggle");d.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!a(this).is(":hidden,:disabled")&&(f?!a(this).prop("checked"):!!e)}),d.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!f&&!!e})})},initDateField:function(){a(".erp-leave-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),a(".erp-leave-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-date-picker-to").datepicker("option","minDate",b)}}),a(".erp-leave-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(b){a(".erp-leave-date-picker-from").datepicker("option","maxDate",b)}})},holiday:{checkRange:function(){a('input[name="range"]').is(":checked")?a('input[name="end_date"]').closest(".row").show():a('input[name="end_date"]').closest(".row").hide()},create:function(c){c.preventDefault(),a.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_create,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){b.initDateField(),b.holiday.checkRange(),b.initToggleCheckbox()},onSubmit:function(a){c.data.holiday.submit.call(this,a)}})},edit:function(c){c.preventDefault();var d=a(this);a.erpPopup({title:wpErpHr.popup.holiday,button:wpErpHr.popup.holiday_update,id:"erp-hr-holiday-create-popup",content:wperp.template("erp-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){b.initDateField(),b.holiday.checkRange();var c=this;a("header",c).after(a('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-holiday",{data:{id:d.data("id"),_wpnonce:wpErpHr.nonce},success:function(b){a(".loader",c).remove();var d=b.holiday;a("#erp-hr-holiday-title",c).val(d.title),a("#erp-hr-holiday-start",c).val(d.start),a("#erp-hr-holiday-end",c).val(d.end),a("#erp-hr-holiday-id",c).val(d.id),a("#erp-hr-holiday-description",c).val(d.description),a("#erp-hr-holiday-action",c).val("erp_hr_holiday_create");var e=new Date(d.start),f=new Date(d.end),g=Math.abs(f.getTime()-e.getTime());Math.ceil(g/864e5)>0&&(a("#erp-hr-holiday-range").attr("checked","checked"),a("#erp-hr-holiday-range").trigger("change"))}})},onSubmit:function(a){c.data.holiday.submit.call(this,a)}})},remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmHoliday)&&wp.ajax.send("erp-hr-holiday-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(a){alert(a)}})},submit:function(c){wp.ajax.send({data:this.serializeObject(),success:function(){c.closeModal(),a(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){b.initDateField(),b.initToggleCheckbox()})},error:function(a){c.enableButton(),c.showError(a)}})}},policy:{periodField:function(){3==a(".erp-hr-leave-period").val()&&a(".hide-if-manual").hide(),a(".erp-hr-leave-period").on("change",function(){var b=a(this).val();2==b?a(".showifschedule").slideDown():a(".showifschedule").slideUp(),3!=b?a(".hide-if-manual").slideDown():a(".hide-if-manual").slideUp()})},submit:function(c){wp.ajax.send({data:this.serializeObject(),success:function(){c.closeModal(),a(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){b.initToggleCheckbox()})},error:function(a){c.enableButton(),alert(a)}})},create:function(c){c.preventDefault(),a.erpPopup({title:wpErpHr.popup.policy,button:wpErpHr.popup.policy_create,id:"erp-hr-leave-policy-create-popup",content:wp.template("erp-leave-policy")({data:null}).trim(),extraClass:"smaller",onReady:function(){b.initDateField(),a(".erp-color-picker").wpColorPicker().wpColorPicker("color","#fafafa"),b.policy.periodField()},onSubmit:function(a){c.data.policy.submit.call(this,a)}})},edit:function(c){c.preventDefault();var d=a(this),e=d.closest("tr").data("json");a.erpPopup({title:wpErpHr.popup.policy,button:wpErpHr.popup.update_status,id:"erp-hr-leave-policy-edit-popup",content:wperp.template("erp-leave-policy")(e).trim(),extraClass:"smaller",onReady:function(){var c=this;b.initDateField(),a(".erp-color-picker").wpColorPicker(),a("div.row[data-selected]",c).each(function(){var b=a(this),c=b.data("selected");""!==c&&b.find("select").val(c)}),a("div.row[data-checked]",c).each(function(b,c){var d=a(this),e=d.data("checked");""!==e&&d.find('input[value="'+e+'"]').attr("checked","checked")}),b.policy.periodField(),a(".erp-hr-leave-period").trigger("change")},onSubmit:function(a){c.data.policy.submit.call(this,a)}})},remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmPolicy)&&wp.ajax.send("erp-hr-leave-policy-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(a){alert(a)}})}},entitlement:{remove:function(b){b.preventDefault();var c=a(this);confirm(wpErpHr.delConfirmEntitlement)&&wp.ajax.send("erp-hr-leave-entitlement-delete",{data:{_wpnonce:wpErpHr.nonce,id:c.data("id"),user_id:c.data("user_id"),policy_id:c.data("policy_id")},success:function(){c.closest("tr").fadeOut("fast",function(){a(this).remove()})},error:function(a){alert(a)}})}},leave:{takeLeave:function(c){c.preventDefault(),a.erpPopup({title:wpErpHr.popup.new_leave_req,button:wpErpHr.popup.take_leave,id:"erp-hr-new-leave-req-popup",content:wp.template("erp-new-leave-req")().trim(),extraClass:"smaller",onReady:function(){b.initDateField()},onSubmit:function(b){a("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send({data:this.serialize(),success:function(a){b.enableButton(),alert(a),b.closeModal()},error:function(a){b.enableButton(),b.showError(a)}})}})},requestDates:function(){var b=a("#erp-hr-leave-req-from-date").val(),c=a("#erp-hr-leave-req-to-date").val(),d=a(this).closest("form").find("input[type=submit]"),e=parseInt(a("#erp-hr-leave-req-employee-id").val()),f=a("#erp-hr-leave-req-leave-policy").val();""!==b&&""!==c&&wp.ajax.send("erp-hr-leave-request-req-date",{data:{_wpnonce:wpErpHr.nonce,from:b,to:c,employee_id:e,type:f},success:function(b){var c=wp.template("erp-leave-days")(b.print);a("div.erp-hr-leave-req-show-days").html(c),parseInt(b.leave_count)<=0?d.prop("disabled",!0):d.prop("disabled",!1)},error:function(b){a("div.erp-hr-leave-req-show-days").empty(),d.attr("disabled","disable"),void 0!==b&&alert(b)}})},setPolicy:function(){b.leave.resetDateRange();var c=a(this),d=a("div.erp-hr-leave-reqs-wrap"),e=d.find(".erp-hr-leave-type-wrapper");e.html(""),0!=c.val()&&wp.ajax.send("erp-hr-leave-employee-assign-policies",{data:{_wpnonce:wpErpHr.nonce,employee_id:c.val()},success:function(a){e.html(a).hide().fadeIn(),d.find('input[type="text"], textarea').removeAttr("disabled")},error:function(a){e.html(wpErpHr.empty_entitlement_text).hide().fadeIn()}})},setAvailableDays:function(){b.leave.resetDateRange();var c=a(this);wp.ajax.send("erp-hr-leave-policies-availablity",{data:{_wpnonce:wpErpHr.nonce,employee_id:a("#erp-hr-leave-req-employee-id").val(),policy_id:c.val()},success:function(b){c.closest("div.row").find("span.description").remove(),a(b).insertAfter(c)},error:function(a){alert(a)}})},resetDateRange:function(){a("#erp-hr-leave-req-from-date").val(""),a("#erp-hr-leave-req-to-date").val(""),a("div.erp-hr-leave-req-show-days").html("")},showHistory:function(b){b.preventDefault();var c=a(this);wp.ajax.send("erp-hr-empl-leave-history",{data:c.serializeObject(),success:function(b){a("table#erp-hr-empl-leave-history tbody").html(b)}})},pageReload:function(){a(".erp-hr-leave-requests").load(window.location.href+" .erp-hr-leave-requests-inner")},reject:function(c){c.preventDefault();var d=a(this),e={id:d.data("id")};a.erpPopup({title:wpErpHr.popup.leave_reject,button:wpErpHr.popup.update_status,id:"erp-hr-leave-reject-popup",content:wperp.template("erp-hr-leave-reject-js-tmp")(e).trim(),extraClass:"smaller",onSubmit:function(a){wp.ajax.send({data:this.serialize()+"&_wpnonce="+wpErpHr.nonce,success:function(c){b.leave.pageReload(),a.closeModal()},error:function(b){a.showError(b)}})}})}},importICalInit:function(b){b.preventDefault(),a("body #erp-ical-input").trigger("click")},uploadICal:function(c){c.preventDefault();var d=c.target.files[0],e=new FormData,f=a(this).parents("form");e.append("ics",d),e.append("action","erp-hr-import-ical"),e.append("_wpnonce",wpErpHr.nonce),wp.ajax.send({data:e,cache:!1,processData:!1,contentType:!1,success:function(){a(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){b.initDateField()}),f[0].reset()},error:function(a){f[0].reset(),alert(a)}})}};a(function(){b.initialize()})}(jQuery);