window.wperp=window.wperp||{},function(a){"use strict";wperp.template=function(b){var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(d){return _.template(a("#tmpl-"+b).html(),null,c)(d)}},wperp.scriptReload=function(b,c){wp.ajax.send({data:{action:b},success:function(b){a("#"+c).html(b.content)},error:function(a){alert(a)}})},wperp.timeFormat=function(a){if(null!=a){var b=a.toString();a=new Date(b.substr(0,4),b.substr(5,2)-1,b.substr(8,2),b.substr(11,2),b.substr(14,2),b.substr(17,2));var c=a.getHours(),d=a.getMinutes(),e=c>=12?"pm":"am";c%=12,c=c?c:12,d=10>d?"0"+d:d;var f=c+":"+d+" "+e;return f}},wperp.dateFormat=function(a,b){if(null!=a){var c=a.toString();a=new Date(c.substr(0,4),c.substr(5,2)-1,c.substr(8,2),c.substr(11,2),c.substr(14,2),c.substr(17,2));var d=("0"+(a.getMonth()+1)).slice(-2),e=("0"+a.getDate()).slice(-2),f=a.getFullYear(),g=["January","February","March","April","May","June","July","August","September","October","November","December"],h=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],i=g[a.getMonth()],j=h[a.getMonth()],k={Y:f,m:d,F:i,M:j,d:e,j:e},l=b.replace(/Y|m|d|j|M|F/gi,function(a){return k[a]});return l}},wperp.parseCondition=function(a){var b={},c=a.split(/([a-zA-Z0-9\s\-\_\+\.\:]+)/);return""==c[0]?(b.condition="",b.val=c[1]):(b.condition=c[0],b.val=c[1]),b},wperp.erp_parse_str=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=String(a).replace(/^&/,"").replace(/^\?/,"").replace(/&$/,"").split("&"),s=r.length,t=function(a){return decodeURIComponent(a.replace(/\+/g,"%20"))};for(b||(b=this.window),c=0;s>c;c++){for(l=r[c].split("="),m=t(l[0]),n=l.length<2?"":t(l[1]);" "===m.charAt(0);)m=m.slice(1);if(m.indexOf("\x00")>-1&&(m=m.slice(0,m.indexOf("\x00"))),m&&"["!==m.charAt(0)){for(p=[],o=0,d=0;d<m.length;d++)if("["!==m.charAt(d)||o){if("]"===m.charAt(d)&&o&&(p.length||p.push(m.slice(0,o-1)),p.push(m.substr(o,d-o)),o=0,"["!==m.charAt(d+1)))break}else o=d+1;for(p.length||(p=[m]),d=0;d<p[0].length&&(k=p[0].charAt(d),(" "===k||"."===k||"["===k)&&(p[0]=p[0].substr(0,d)+"_"+p[0].substr(d+1)),"["!==k);d++);for(h=b,d=0,q=p.length;q>d;d++)if(m=p[d].replace(/^['"]/,"").replace(/['"]$/,""),i=d!==p.length-1,g=h,""!==m&&" "!==m||0===d)h[m]===j&&(h[m]={}),h=h[m];else{e=-1;for(f in h)h.hasOwnProperty(f)&&+f>e&&f.match(/^\d+$/g)&&(e=+f);m=e+1}g[m]=n}}},wperp.erpGetParamByName=function(a,b){b=b.toLowerCase(),a=a.replace(/[\[\]]/g,"\\$&").toLowerCase();var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},wperp.erpRemoveURLParameter=function(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-->0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=c[0]+(e.length>0?"?"+e.join("&"):"")}return a},wperp.swalSpinnerVisible=function(){swal({title:"",html:!0,showCancelButton:!1,showConfirmButton:!1}),a(".la-ball-fall").css({opacity:1,visibility:"visible",top:"-17px",color:"#008ec2"})},wperp.swalSpinnerHidden=function(){a(".la-ball-fall").css({opacity:0,visibility:"hidden"})};var b={initialize:function(){a("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),a("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),a("body").on("click","a#erp-company-new-location",this.newCompanyLocation),a(".erp-company-single").on("click","a.edit-location",this.editCompanyLocation),a(".erp-company-single").on("click","a.remove-location",this.removeCompanyLocation),a("body").on("change","select.erp-country-select",this.populateState),a("body").on("erp-hr-after-new-location",this.afterNewLocation),a(".erp-hr-audit-log").on("click","a.erp-audit-log-view-changes",this.viewLogChanges),a("body").on("change","#filter_duration",this.customFilter),this.initFields()},afterNewLocation:function(b,c){wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),a(".erp-hr-location-drop-down").append('<option selected="selected" value="'+c.id+'">'+c.title+"</option>"),a(".erp-hr-location-drop-down").select2("val",c.id)},initFields:function(){a(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+0"}),a(".erp-select2").select2({placeholder:a(this).attr("data-placeholder")})},viewLogChanges:function(b){b.preventDefault();var c=a(this);wp.ajax.send("erp_audit_log_view",{data:{id:c.data("id"),_wpnonce:wpErpHr.nonce},success:function(b){a.erpPopup({title:b.title,button:"",id:"erp-audit-log-popup",content:b.content,extraClass:"midium"})},error:function(a){alert(a)}})},setCompanyLogo:function(b){b.preventDefault(),b.stopPropagation();var c;return c?void c.open():(c=wp.media({title:wpErp.upload_logo,button:{text:wpErp.set_logo}}),c.on("select",function(){var b=c.state().get("selection");b.map(function(b){b=b.toJSON();var c='<img src="'+b.url+'" alt="" />';c+='<input type="hidden" name="company_logo_id" value="'+b.id+'" />',c+='<a href="#" class="remove-logo">'+wpErp.remove_logo+"</a>",a(".inside","#postimagediv").html(c)})}),void c.open())},removeCompanyLogo:function(b){b.preventDefault();var c='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpErp.upload_logo+"</a>";a(".inside","#postimagediv").html(c)},populateState:function(){if("undefined"==typeof wpErpCountries)return!1;var b=a(this),c=b.val(),d=b.closest(b.data("parent")),e='<option value="-1">- Select -</option>';if(wpErpCountries[c]){var f="",g=wpErpCountries[c];for(var h in g)f=f+'<option value="'+h+'">'+g[h]+"</option>";a.isArray(wpErpCountries[c])?d.find("select.erp-state-select").html(e):d.find("select.erp-state-select").html(f)}else d.find("select.erp-state-select").html(e)},customFilter:function(){if("custom"!=this.value)a("#custom-input").remove();else{var c='<span id="custom-input"><span>From </span><input name="start" class="erp-date-field" type="text">&nbsp;<span>To </span><input name="end" class="erp-date-field" type="text"></span>&nbsp;';a("#filter_duration").after(c),b.initFields()}},newCompanyLocation:function(b){b.preventDefault();var c=a(this);a.erpPopup({title:c.data("title"),button:wpErp.create,id:"erp-new-location",content:wp.template("erp-address")({company_id:c.data("id")}).trim(),extraClass:"medium",onReady:function(){a(".select2").select2()},onSubmit:function(b){wp.ajax.send({data:this.serialize(),success:function(d){a("#company-locations").load(window.location.href+" #company-locations-inside"),c.hasClass("erp-add-new-location")||a("body").trigger("erp-hr-after-new-location",[d]),b.closeModal()},error:function(a){b.showError(a)}})}})},editCompanyLocation:function(b){b.preventDefault();var c=a(this);a.erpPopup({title:wpErp.update_location,button:wpErp.update_location,id:"erp-edit-location",content:wp.template("erp-address")(c.data("data")),extraClass:"medium",onReady:function(){a(".select2").select2(),a("li[data-selected]",this).each(function(){var b=a(this),c=b.data("selected");""!==c&&b.find("select").val(c)}),a("select.erp-country-select").change()},onSubmit:function(b){wp.ajax.send({data:this.serializeObject(),success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside"),b.closeModal()},error:function(a){b.showError(a)}})}})},removeCompanyLocation:function(b){b.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-delete-comp-location",{data:{id:a(this).data("id"),_wpnonce:wpErp.nonce},success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside")}})}};a(function(){b.initialize()})}(jQuery,this),jQuery.fn.serializeObject=function(){var a={},b=this.serializeArray();return jQuery.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.erp.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.erp.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("erp.dropdown");d||c.data("erp.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".erp-dropdown-backdrop",f='[data-toggle="erp-dropdown"]',g=function(b){a(b).on("click.erp.dropdown",this.toggle)};g.VERSION="1.0.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("erp-dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.erp.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.erp.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".erp-dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.erpDropdown;a.fn.erpDropdown=d,a.fn.erpDropdown.Constructor=g,a.fn.erpDropdown.noConflict=function(){return a.fn.erpDropdown=h,this},a(document).on("click.erp.dropdown.data-api",c).on("click.erp.dropdown.data-api",".erp-dropdown form",function(a){a.stopPropagation()}).on("click.erp.dropdown.data-api",f,g.prototype.toggle).on("keydown.erp.dropdown.data-api",f,g.prototype.keydown).on("keydown.erp.dropdown.data-api",".erp-dropdown-menu",g.prototype.keydown)}(jQuery);