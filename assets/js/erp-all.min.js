window.wperp=window.wperp||{},function(a){"use strict";wperp.template=function(t){var o={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e){return _.template(a("#tmpl-"+t).html(),null,o)(e)}},wperp.scriptReload=function(e,t){wp.ajax.send({data:{action:e},success:function(e){a("#"+t).html(e.content)},error:function(e){alert(e)}})},wperp.timeFormat=function(e){if(null!=e){var t=e.toString(),o=(e=new Date(t.substr(0,4),t.substr(5,2)-1,t.substr(8,2),t.substr(11,2),t.substr(14,2),t.substr(17,2))).getHours(),n=e.getMinutes(),i=12<=o?"pm":"am";return(o=(o%=12)||12)+":"+(n=n<10?"0"+n:n)+" "+i}},wperp.dateFormat=function(e,t){if(null!=e){var o=e.toString(),n=("0"+((e=new Date(o.substr(0,4),o.substr(5,2)-1,o.substr(8,2),o.substr(11,2),o.substr(14,2),o.substr(17,2))).getMonth()+1)).slice(-2),i=("0"+e.getDate()).slice(-2),r={Y:e.getFullYear(),m:n,F:["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],M:["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][e.getMonth()],d:i,j:i};return t.replace(/Y|m|d|j|M|F/gi,function(e){return r[e]})}},wperp.parseCondition=function(e){var t={},o=e.split(/([a-zA-Z0-9\s\-\_\+\.\,\:]+)/);return""==o[0]?t.condition="":t.condition=o[0],t.val=o[1],t},wperp.erp_parse_str=function(e,t){var o,n,i,r,a,s,p,l,d,c,u,h,m,f=String(e).replace(/^&/,"").replace(/^\?/,"").replace(/&$/,"").split("&"),g=f.length,v=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))};for(t||(t=this.window),o=0;o<g;o++){for(d=v((l=f[o].split("="))[0]),c=l.length<2?"":v(l[1]);" "===d.charAt(0);)d=d.slice(1);if(-1<d.indexOf("\0")&&(d=d.slice(0,d.indexOf("\0"))),d&&"["!==d.charAt(0)){for(h=[],n=u=0;n<d.length;n++)if("["!==d.charAt(n)||u){if("]"===d.charAt(n)&&u&&(h.length||h.push(d.slice(0,u-1)),h.push(d.substr(u,n-u)),u=0,"["!==d.charAt(n+1)))break}else u=n+1;for(h.length||(h=[d]),n=0;n<h[0].length&&(" "!==(p=h[0].charAt(n))&&"."!==p&&"["!==p||(h[0]=h[0].substr(0,n)+"_"+h[0].substr(n+1)),"["!==p);n++);for(s=t,n=0,m=h.length;n<m;n++)if(d=h[n].replace(/^['"]/,"").replace(/['"]$/,""),h.length,a=s,""!==d&&" "!==d||0===n)void 0===s[d]&&(s[d]={}),s=s[d];else{for(r in i=-1,s)s.hasOwnProperty(r)&&i<+r&&r.match(/^\d+$/g)&&(i=+r);d=i+1}a[d]=c}}},wperp.erpGetParamByName=function(e,t){t=t.toLowerCase(),e=e.replace(/[\[\]]/g,"\\$&").toLowerCase();var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null},wperp.erpRemoveURLParameter=function(e,t){var o=e.split("?");if(2<=o.length){for(var n=encodeURIComponent(t)+"=",i=o[1].split(/[&;]/g),r=i.length;0<r--;)-1!==i[r].lastIndexOf(n,0)&&i.splice(r,1);return o[0]+(0<i.length?"?"+i.join("&"):"")}return e},wperp.swalSpinnerVisible=function(){swal({title:"",html:!0,showCancelButton:!1,showConfirmButton:!1}),a(".la-ball-fall").css({opacity:1,visibility:"visible",top:"-17px",color:"#008ec2"})},wperp.swalSpinnerHidden=function(){a(".la-ball-fall").css({opacity:0,visibility:"hidden"})};var o={initialize:function(){a("body").on("mouseover",".pro-popup",this.proPopupTooltip),a("body").on("click",".pro-popup-main",this.proPopup),a("body").on("click",".reports-popup",this.proPopup),a(".org-chart").on("click",".pro-popup",this.proPopup),a("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),a("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),a("body").on("click","a#erp-company-new-location",this.newCompanyLocation),a(".erp-company-single").on("click","a.edit-location",this.editCompanyLocation),a(".erp-company-single").on("click","a.remove-location",this.removeCompanyLocation),a(".erp-hr-employees").on("click","a#erp-employee-new",this.modalOpen),a("body").on("click","a#erp-company-new-location",this.modalOpen),a("body").on("click","#erp-customer-new",this.modalOpen),a("body").on("change","select.erp-country-select",this.populateState),a("body").on("erp-hr-after-new-location",this.afterNewLocation),a(".erp-hr-audit-log").on("click","a.erp-audit-log-view-changes",this.viewLogChanges),a("body").on("change","#filter_duration",this.customFilter),a("body").on("click",".notice-pdf .notice-dismiss",this.pdfNotice.dismiss),a("body").on("click",".email-subscribe-btn",this.emailSubscribe),a("body").on("change","span.checkbox input[required]",this.validateCheckbox),a(".erp-danger-zone").on("input","#erp_reset_confirmation",this.onChangeDangerZoneInput),a(".erp-danger-zone").on("click","button.tools-btn-submit",this.viewDangerZoneConfirmation),a(".wrap.erp #message button.notice-dismiss").on("click",this.dismissNoticeMessage),this.initFields(),this.initTipTip()},initTipTip:function(){a(".erp-tips").tipTip({defaultPosition:"top",fadeIn:100,fadeOut:100})},proPopupTooltip:function(e){e.preventDefault(),a(".pro-popup").mouseover(function(e){a(".org-chart").mouseover(function(e){a(".erp-custom-menu-container").css("overflow-x","inherit")}),a(".org-chart").mouseout(function(e){a(".erp-custom-menu-container").css("overflow-x","auto")}),a(".erp-pro-tooltip-wrapper").remove(),a(this).closest(".pro-popup").append('<div class="erp-pro-tooltip-wrapper"><div class="erp-pro-tooltip-inner"> <h4>Available in Pro. Also enjoy:</h4><ul> <li><span class="dashicons dashicons-yes"></span>23+ premium extensions</li> <li><span class="dashicons dashicons-yes"></span>24/7 customer support</li> <li><span class="dashicons dashicons-yes"></span>Recurring task automation</li> <li><span class="dashicons dashicons-yes"></span>Work-From-Home feature</li> <li><span class="dashicons dashicons-yes"></span>Option to choose extensions</li> </ul> <div class="tooltip-btn"> <a class="tooltip_button" href="#">Upgrade to PRO '+"<svg width='16' height='13' viewBox='0 0 16 13' fill='none' xmlns='http://www.w3.org/2000/svg'>\n<path d='M15.3705 3.8954C15.3729 3.93956 15.3697 3.9845 15.3586 4.02914L14.3717 9.18914C14.3219 9.38864 14.1437 9.52892 13.9388 9.53L8.01729 9.56H8.01501H2.09346C1.88746 9.56 1.70796 9.41924 1.6582 9.21872L0.671282 4.04372C0.659918 3.99788 0.656628 3.95168 0.659499 3.90638C0.277712 3.78572 0 3.42734 0 3.005C0 2.4839 0.422579 2.06 0.942056 2.06C1.46153 2.06 1.88411 2.4839 1.88411 3.005C1.88411 3.29846 1.75007 3.56102 1.54019 3.73448L2.77581 4.98332C3.08809 5.29898 3.52144 5.47994 3.96477 5.47994C4.48897 5.47994 4.98877 5.23022 5.30351 4.81184L7.33416 2.1128C7.16357 1.9418 7.05794 1.70552 7.05794 1.445C7.05794 0.9239 7.48052 0.5 8 0.5C8.51948 0.5 8.94206 0.9239 8.94206 1.445C8.94206 1.69772 8.84205 1.9271 8.68037 2.09684L8.68211 2.09894L10.698 4.80542C11.0127 5.22782 11.5143 5.48 12.04 5.48C12.4874 5.48 12.9081 5.30522 13.2244 4.98782L14.4678 3.74054C14.2535 3.56714 14.1159 3.30206 14.1159 3.005C14.1159 2.4839 14.5385 2.06 15.0579 2.06C15.5774 2.06 16 2.4839 16 3.005C16 3.41606 15.7365 3.76568 15.3705 3.8954ZM14.2754 10.97C14.2754 10.7215 14.0746 10.52 13.8268 10.52H2.22307C1.97533 10.52 1.77447 10.7215 1.77447 10.97V12.05C1.77447 12.2985 1.97533 12.5 2.22307 12.5H13.8268C14.0746 12.5 14.2754 12.2985 14.2754 12.05V10.97Z' fill='white' />\n</svg></a> </div> </div></div>")}),a(".pro-popup").mouseout(function(e){a(".erp-pro-tooltip-wrapper").remove()})},proPopup:function(e){e.preventDefault(),a.erpPopup({title:"",button:"",id:"erp-pro-popup-modal",content:wperp.template("erp-pro-popup-modal"),extraClass:"larger",footer:!1});var t=2;setInterval(function(){var e=a("#img-"+t);4===t?t=1:t++,e.click()},4e3)},afterNewLocation:function(e,t){wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),a(".erp-hr-location-drop-down").append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),a(".erp-hr-location-drop-down").select2("val",t.id)},initFields:function(){a(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+5"}),a(".erp-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(e){a(".erp-date-picker-to").datepicker("option","minDate",e)}}),a(".erp-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(e){a(".erp-date-picker-from").datepicker("option","maxDate",e)}}),a(".erp-select2").select2({placeholder:a(this).attr("data-placeholder")});var e=a(".erp-settings").find("#mainform"),t=a(".erp-tools-form");e.length&&e.areYouSure({message:wpErp.formUnsavedMsg}),t.length&&t.areYouSure({message:wpErp.formUnsavedMsg})},viewLogChanges:function(e){e.preventDefault();var t=a(this);wp.ajax.send("erp_audit_log_view",{data:{id:t.data("id"),_wpnonce:wpErp.nonce},success:function(e){a.erpPopup({title:e.title,button:"",id:"erp-audit-log-popup",content:e.content,extraClass:"midium"})},error:function(e){alert(e)}})},setCompanyLogo:function(e){var t;e.preventDefault(),e.stopPropagation(),t||(t=wp.media({title:wpErp.upload_logo,button:{text:wpErp.set_logo}})).on("select",function(){t.state().get("selection").map(function(e){var t='<img src="'+(e=e.toJSON()).url+'" alt="" />';t+='<input type="hidden" name="company_logo_id" value="'+e.id+'" />',t+='<a href="#" class="remove-logo">'+wpErp.remove_logo+"</a>",a(".inside","#postimagediv").html(t)})}),t.open()},removeCompanyLogo:function(e){e.preventDefault();var t='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpErp.upload_logo+"</a>";a(".inside","#postimagediv").html(t)},modalOpen:function(){setTimeout(function(){a("select.erp-country-select").trigger("change")},499)},populateState:function(){if("undefined"==typeof wpErpCountries)return!1;var e=a(this).val(),t=a(".state-field").find("#erp-state"),o='<option value="-1">- Select -</option>';if(wpErpCountries[e]){var n="",i=wpErpCountries[e];for(var r in i)n=n+'<option value="'+r+'">'+i[r]+"</option>";a.isArray(wpErpCountries[e])?t.html(o):t.html(n)}else t.html(o)},pdfNotice:{dismiss:function(e){a.ajax({url:ajaxurl,data:{_wpnonce:wpErp.nonce,action:"dismiss_pdf_notice"}})}},customFilter:function(){"custom"!=this.value?a("#custom-input").remove():(a("#filter_duration").after('<span id="custom-input"><span>From </span><input name="start" class="erp-date-field" type="text">&nbsp;<span>To </span><input name="end" class="erp-date-field" type="text"></span>&nbsp;'),o.initFields())},newCompanyLocation:function(e){e.preventDefault();var o=a(this);a.erpPopup({title:o.data("title"),button:wpErp.create,id:"erp-new-location",content:wp.template("erp-address")({company_id:o.data("id")}).trim(),extraClass:"medium",onReady:function(){a(".select2").select2()},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){a("#company-locations").load(window.location.href+" #company-locations-inside"),o.hasClass("erp-add-new-location")||a("body").trigger("erp-hr-after-new-location",[e]),t.closeModal()},error:function(e){t.showError(e)}})}})},editCompanyLocation:function(e){e.preventDefault();var t=a(this);a.erpPopup({title:wpErp.update_location,button:wpErp.update_location,id:"erp-edit-location",content:wp.template("erp-address")(t.data("data")),extraClass:"medium",onReady:function(){a(".select2").select2(),a("li[data-selected]",this).each(function(){var e=a(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),a("select.erp-country-select").change()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside"),t.closeModal()},error:function(e){t.showError(e)}})}})},removeCompanyLocation:function(e){e.preventDefault(),confirm(wpErp.confirmMsg)&&wp.ajax.send("erp-delete-comp-location",{data:{id:a(this).data("id"),_wpnonce:wpErp.nonce},success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside")}})},validEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},emailSubscribe:function(e){e.preventDefault();var t=a(".email-subscribe").val();o.validEmail(t)&&(a(this).prop("disabled",!0),a.ajax({url:"https://wedevs.us16.list-manage.com/subscribe/post-json?u=66e606cfe0af264974258f030&id=bc304ef91b&c=?",data:{EMAIL:t},type:"GET",dataType:"json",cache:!1,contentType:"application/json; charset=utf-8"}).success(function(e){a(".erp-newsletter").find(".erp-form-wrap").css("display","none"),a(".erp-newsletter").find(".erp-thank-you").html(e.msg).css("display","block")}))},validateCheckbox:function(e){var t=a(this),o=t.attr("name"),n=a("input[name='"+o+"']");if(t[0].hasAttribute("required")){var i=0;n.each(function(){var e=a(this);e.is(":checked")?e.attr("required","required"):(e.removeAttr("required"),i++)}),n.length===i&&n.each(function(){a(this).attr("required","required")})}},viewDangerZoneConfirmation:function(e){e.preventDefault();var t=a("#erp_reset_confirmation"),o=a(".tools-btn-submit"),n=a(".tools-btn-loading"),i=a(".tools-error-message"),r=t.val();void 0!==r&&0!==String(r).length&&"Reset"===r?(i.html(""),t.removeClass("tools-error-input"),swal({title:wpErpDangerZone.resetErp,text:wpErpDangerZone.areYouSureReset,showCancelButton:!0,confirmButtonText:wpErpDangerZone.yesResetIt,confirmButtonColor:"#FF4848",imageUrl:wpErpDangerZone.trashIcon},function(){o.addClass("tools-submit-hidden"),n.removeClass("tools-submit-hidden"),a.ajax({type:"POST",url:ajaxurl,dataType:"json",data:a("#danger-zone-form").serialize()}).fail(function(e){swal("",wpErpDangerZone.somethingWrong,"error"),o.removeClass("tools-submit-hidden"),n.addClass("tools-submit-hidden")}).done(function(e){e.success?(o.removeClass("tools-submit-hidden"),n.addClass("tools-submit-hidden"),swal({title:"",text:e.data.message,time:3e3,type:"success",showConfirmButton:!1}),setTimeout(function(){window.location.href=e.data.redirected_url},1e3)):(o.removeClass("tools-submit-hidden"),n.addClass("tools-submit-hidden"),swal("",e.data,"error"))})})):(i.html(wpErpDangerZone.confirmResetBeforeContinue),t.addClass("tools-error-input"))},onChangeDangerZoneInput:function(e){var t=a("#erp_reset_confirmation"),o=t.val();void 0!==o&&0!==String(o).length&&"Reset"===o?(a(".tools-error-message").html(""),t.removeClass("tools-error-input"),t.addClass("tools-success-input")):(t.removeClass("tools-success-input"),a(".tools-error-message").html(wpErpDangerZone.confirmResetBeforeContinue),t.addClass("tools-error-input"))},dismissNoticeMessage:function(e){e.preventDefault(),e.target.closest("div").remove()}};a(function(){o.initialize()})}(jQuery),jQuery.fn.serializeObject=function(){var e={},t=this.serializeArray();return jQuery.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},function(a){"use strict";var s='[data-toggle="erp-dropdown"]',n=function(e){a(e).on("click.erp.dropdown",this.toggle)};function p(e){var t=e.attr("data-target");t||(t=(t=e.attr("href"))&&/#[A-Za-z]/.test(t)&&t.replace(/.*(?=#[^\s]*$)/,""));var o=t&&a(t);return o&&o.length?o:e.parent()}function r(n){n&&3===n.which||(a(".erp-dropdown-backdrop").remove(),a(s).each(function(){var e=a(this),t=p(e),o={relatedTarget:this};t.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&a.contains(t[0],n.target)||(t.trigger(n=a.Event("hide.erp.dropdown",o)),n.isDefaultPrevented()||(e.attr("aria-expanded","false"),t.removeClass("open").trigger(a.Event("hidden.erp.dropdown",o)))))}))}n.VERSION="1.0.0",n.prototype.toggle=function(e){var t=a(this);if(!t.is(".disabled, :disabled")){var o=p(t),n=o.hasClass("open");if(r(),!n){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("erp-dropdown-backdrop").insertAfter(a(this)).on("click",r);var i={relatedTarget:this};if(o.trigger(e=a.Event("show.erp.dropdown",i)),e.isDefaultPrevented())return;t.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(a.Event("shown.erp.dropdown",i))}return!1}},n.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var t=a(this);if(e.preventDefault(),e.stopPropagation(),!t.is(".disabled, :disabled")){var o=p(t),n=o.hasClass("open");if(!n&&27!=e.which||n&&27==e.which)return 27==e.which&&o.find(s).trigger("focus"),t.trigger("click");var i=o.find(".erp-dropdown-menu li:not(.disabled):visible a");if(i.length){var r=i.index(e.target);38==e.which&&0<r&&r--,40==e.which&&r<i.length-1&&r++,~r||(r=0),i.eq(r).trigger("focus")}}}};var e=a.fn.erpDropdown;a.fn.erpDropdown=function(o){return this.each(function(){var e=a(this),t=e.data("erp.dropdown");t||e.data("erp.dropdown",t=new n(this)),"string"==typeof o&&t[o].call(e)})},a.fn.erpDropdown.Constructor=n,a.fn.erpDropdown.noConflict=function(){return a.fn.erpDropdown=e,this},a(document).on("click.erp.dropdown.data-api",r).on("click.erp.dropdown.data-api",".erp-dropdown form",function(e){e.stopPropagation()}).on("click.erp.dropdown.data-api",s,n.prototype.toggle).on("keydown.erp.dropdown.data-api",s,n.prototype.keydown).on("keydown.erp.dropdown.data-api",".erp-dropdown-menu",n.prototype.keydown),window.addEventListener("click",function(e){var t=document.querySelectorAll(".wperp-filter-dropdown")[0],o=document.querySelector(".select2-container--open"),n=document.querySelectorAll(".daterangepicker")[0],i=void 0!==t&&!t.contains(e.target),r=void 0!==n&&n.contains(e.target);i&&null===o&&!r&&document.getElementById("erp-dropdown-content").classList.remove("show")})}(jQuery),function(n,e,t,o){var i={title:"",content:"",id:"",button:"Submit",extraClass:"",onReady:function(){},onSubmit:function(){},beforeClose:function(){}};function r(e){this.settings=n.extend({},i,e),this.element=n(this.settings.content),this.id=this.settings.id,this._defaults=i,this._name="erpPopup",this.init()}n.extend(r.prototype,{init:function(){this.show_modal(),this.bindEvents()},bindEvents:function(){n("form.erp-modal-form","#"+this.settings.id).on("submit",n.proxy(this.formSubmit,this)),n(".erp-modal-backdrop, .erp-modal .close").on("click",n.proxy(this.closeModal,this)),n("body").on("keydown","#"+this.id,n.proxy(this.onEscapeKey,this)),n("#"+this.id).focus()},formSubmit:function(e){e.preventDefault(),n(".erp-modal-backdrop, .erp-modal").find(".erp-loader").removeClass("erp-hide"),this.settings.onSubmit.call(n(e.currentTarget),this)},show_modal:function(){if(""!==this.id&&!n("#"+this.id).length){var e=n("#erp-modal").find(".erp-modal").clone();""!==this.settings.extraClass&&e.addClass(this.settings.extraClass),e.attr("id",this.id),e.attr("tabindex",-1),e.addClass("erp-count-class"),e.find("h2").text(this.settings.title),""===this.settings.button?e.find("footer").remove():e.find(".button-primary").text(this.settings.button),e.find(".content").empty().html(this.settings.content),e.show(),n("body").append(e);var t=600*n("body").find(".erp-count-class").length,o=t-1;n("#"+this.id).css("z-index",t),n("#"+this.id).after('<div style="z-index: '+o+'" class="erp-modal-backdrop '+this.id+'"></div>'),n("."+this.id).show(),this.settings.onReady.call(e,this)}},onEscapeKey:function(e){27===e.keyCode&&this.closeModal(e)},disableButton:function(){n("button[type=submit]",".erp-modal").attr("disabled","disabled")},enableButton:function(){n("button[type=submit]",".erp-modal").removeAttr("disabled")},closeModal:function(e){void 0!==e&&e.preventDefault(),n(".erp-modal-backdrop, .erp-modal").find(".erp-loader").addClass("erp-hide"),this.settings.beforeClose.call(!1,this),n("#"+this.id).remove(),n("."+this.id).remove()},showError:function(e){n(".erp-modal-backdrop, .erp-modal").find(".erp-loader").addClass("erp-hide"),alert(e)}}),n.erpPopup=function(e){new r(e)}}(jQuery,window,document),jQuery(function(i){i(".colorpick").wpColorPicker(),i(".tips, .help_tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),{init:function(){i("a.erp-image-upload").on("click",this.imageUpload),i("a.erp-remove-image").on("click",this.removeBanner)},imageUpload:function(e){e.preventDefault();var o,n=i(this);o||(o=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1})).on("select",function(){var e=o.state().get("selection").first().toJSON(),t=n.closest("td");t.find("input.erp-file-field").val(e.id),void 0!==e.sizes.thumbnail?t.find("img.erp-option-image").attr("src",e.sizes.thumbnail.url):t.find("img.erp-option-image").attr("src",e.url),i(".image-wrap",t).removeClass("erp-hide"),i(".button-area",t).addClass("erp-hide")}),o.open()},removeBanner:function(e){e.preventDefault();var t=i(this).closest(".image-wrap"),o=t.siblings(".button-area");t.find("input.erp-file-field").val("0"),t.addClass("erp-hide"),o.removeClass("erp-hide")}}.init()}),function(p){window.ERP_Uploader=function(e,t,o,n,i,r,a,s){this.container=o,this.browse_button=t,p("#"+t).length&&(this.uploader=new plupload.Uploader({dragdrop:!0,drop_element:n,runtimes:"html5,html4",browse_button:t,container:o,multipart_params:{action:e,file_id:p("#"+t).data("file_id"),_wpnonce:wpErp.nonce},max_file_size:a+"kb",url:wpErp.plupload.url+"&type="+i,flash_swf_url:wpErp.flash_swf_url,filters:[{title:"Allowed Files",extensions:r}],views:{list:!0,thumbs:!0,active:"thumbs"},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap"}),this.uploader.bind("Init",p.proxy(this,"init")),this.uploader.bind("FilesAdded",p.proxy(this,"added")),this.uploader.bind("QueueChanged",p.proxy(this,"upload")),this.uploader.bind("UploadProgress",p.proxy(this,"progress")),this.uploader.bind("Error",p.proxy(this,"error")),this.uploader.bind("FileUploaded",p.proxy(this,"uploaded")),this.uploader.init(),this.callback=s,p("#"+o).on("click","a.attachment-delete",p.proxy(this.removeAttachment,this)))},ERP_Uploader.prototype={init:function(e,t){},executeFunctionByName:function(e,t,o){if(void 0===e)return!1;o=[].slice.call(arguments).splice(2);for(var n=e.split("."),i=n.pop(),r=0;r<n.length;r++)t=t[n[r]];return"function"==typeof t[i]&&t[i].apply(t,o)},added:function(e,t){p("#"+this.container).find(".erp-attachment-upload-filelist");var o=p("#"+this.container).find(".erp-attachment-list");p.each(t,function(e,t){o.append('<li class="erp-image-wrap thumbnail '+t.id+'"><div class="attachment-name erp-img-progress"><div class="upload-item" id="'+t.id+'"><div class="progress progress-striped active"><div class="bar"></div></div></div></div></li>')}),e.refresh(),e.start()},upload:function(e){this.uploader.start()},progress:function(e,t){var o=p("#"+t.id);p(".bar",o).css({width:t.percent+"%"}),p(".percent",o).html(t.percent+"%")},error:function(e,t){p("#"+this.container).find("#"+t.file.id).remove();var o="";switch(t.code){case-600:o="The file you have uploaded exceeds the file size limit. Please try again.";break;case-601:o="You have uploaded an incorrect file type. Please try again.";break;default:o="Error #"+t.code+": "+t.message}alert(o),this.uploader.refresh()},uploaded:function(e,t,o){var n=p.parseJSON(o.response),i={up:e,file:t,response:o};!1===this.executeFunctionByName(this.callback.after_uploaded,window,i)&&(p("#"+t.id+" b").html("100%"),p("#"+t.id).remove(),n.success?p("."+t.id).replaceWith(n.data):alert(n.error))},removeAttachment:function(e){e.preventDefault();var t=this,o=p(e.currentTarget);if(confirm(wpErp.confirmMsg)){var n={attach_id:o.data("attach_id"),custom_attr:o.closest(".erp-image-wrap").find(".erp-file-mime").data(),_wpnonce:wpErp.nonce,action:"erp_file_del"};jQuery.post(wpErp.ajaxurl,n,function(){o.parent().parent().remove(),t.uploader.refresh()})}}}}(jQuery);